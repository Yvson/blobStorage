Using a shell script to replace a specific placeholder in the Module Federation manifest file before serving your application bundle via Nginx is a practical approach. This allows you to dynamically update remote URLs in the manifest without rebuilding the application, providing flexibility for different environments. Below, I’ll provide a shell script to replace a placeholder in the manifest file and explain how to integrate it into your workflow.

### Assumptions
- The manifest is part of the `remoteEntry.js` file or a separate JSON file (e.g., `manifest.json`) generated by the Module Federation plugin.
- The placeholder in the manifest is `__REMOTE_APP_URL__` (or similar), which needs to be replaced with an actual URL (e.g., `https://prod-remote.com`).
- The application bundle is served from a directory (e.g., `/path/to/dist`) via Nginx.
- Environment variables (e.g., `REMOTE_APP_URL`) are set in the environment or a `.env` file.

### Shell Script to Replace Placeholder

Here’s a shell script that replaces the `__REMOTE_APP_URL__` placeholder in the manifest file with the value of the `REMOTE_APP_URL` environment variable.

```x-shellscript
#!/bin/bash

# Exit on any error
set -e

# Define paths and variables
MANIFEST_FILE="/path/to/dist/remoteEntry.js"  # Adjust to your manifest file path
PLACEHOLDER="__REMOTE_APP_URL__"             # Placeholder to replace
REMOTE_URL="${REMOTE_APP_URL:-https://default-remote.com}"  # Fallback URL if not set

# Check if manifest file exists
if [ ! -f "$MANIFEST_FILE" ]; then
  echo "Error: Manifest file $MANIFEST_FILE not found."
  exit 1
fi

# Check if REMOTE_URL is set
if [ -z "$REMOTE_URL" ]; then
  echo "Error: REMOTE_APP_URL is not set and no default provided."
  exit 1
fi

# Replace placeholder with actual URL
# Use sed to perform in-place replacement
# macOS requires '' after -i; Linux does not
if [[ "$OSTYPE" == "darwin"* ]]; then
  sed -i '' "s|$PLACEHOLDER|$REMOTE_URL|g" "$MANIFEST_FILE"
else
  sed -i "s|$PLACEHOLDER|$REMOTE_URL|g" "$MANIFEST_FILE"
fi

echo "Updated manifest file $MANIFEST_FILE with $REMOTE_URL"

# Optional: Restart Nginx to ensure updated files are served
# Uncomment if needed and adjust service name
# systemctl restart nginx || echo "Failed to restart Nginx, please check manually."

exit 0
```

### How It Works
- **Checks**: Ensures the manifest file exists and `REMOTE_APP_URL` is set, with a fallback default.
- **Replacement**: Uses `sed` to replace `__REMOTE_APP_URL__` with the actual URL in the manifest file.
- **Cross-Platform**: Handles differences between macOS and Linux for `sed -i`.
- **Error Handling**: Exits on errors to prevent partial updates.
- **Nginx Integration**: Optionally restarts Nginx (commented out; enable if needed).

### Steps to Integrate with Nginx

1. **Prepare the Environment**
   - Set the `REMOTE_APP_URL` environment variable, either in your shell or via a `.env` file.
     ```bash
     export REMOTE_APP_URL=https://prod-remote.com
     ```
     Or use a `.env` file with `dotenv`:
     ```env
     REMOTE_APP_URL=https://prod-remote.com
     ```

2. **Place the Script**
   - Save the script as `update-manifest.sh` in your project directory or a system path (e.g., `/usr/local/bin/`).
   - Make it executable:
     ```bash
     chmod +x update-manifest.sh
     ```

3. **Update Nginx Configuration**
   - Ensure Nginx is configured to serve the `dist` directory where your bundle and `remoteEntry.js` are located.
   - Example Nginx config (`/etc/nginx/sites-available/your-app`):
     ```nginx
     server {
       listen 80;
       server_name your-domain.com;

       root /path/to/dist;
       index index.html;

       location / {
         try_files $uri $uri/ /index.html;
       }
     }
     ```
   - Test and reload Nginx:
     ```bash
     sudo nginx -t
     sudo systemctl reload nginx
     ```

4. **Run the Script Before Serving**
   - Execute the script manually or as part of your deployment process:
     ```bash
     ./update-manifest.sh
     ```
   - If using a `.env` file, load it first:
     ```bash
     source .env
     ./update-manifest.sh
     ```

5. **Automate in Deployment**
   - Integrate the script into your CI/CD pipeline or deployment script. For example, in a deployment script:
     ```bash
     #!/bin/bash
     set -e

     # Copy bundle to server
     rsync -avz dist/ user@server:/path/to/dist/

     # Run update-manifest.sh on the server
     ssh user@server 'bash -s' < update-manifest.sh

     # Reload Nginx
     ssh user@server 'sudo systemctl reload nginx'
     ```

   - For Docker-based deployments, add the script to your Dockerfile or entrypoint:
     ```Dockerfile
     COPY update-manifest.sh /app/update-manifest.sh
     RUN chmod +x /app/update-manifest.sh
     ENTRYPOINT ["/app/update-manifest.sh", "&&", "nginx", "-g", "daemon off;"]
     ```

### Example Manifest Before and After
- **Before** (`remoteEntry.js`):
  ```javascript
  // Simplified example
  __webpack_require__.federation.init({
    name: "host",
    remotes: [{ name: "remoteApp", entry: "__REMOTE_APP_URL__/remoteEntry.js" }],
  });
  ```

- **After** (running `update-manifest.sh` with `REMOTE_APP_URL=https://prod-remote.com`):
  ```javascript
  __webpack_require__.federation.init({
    name: "host",
    remotes: [{ name: "remoteApp", entry: "https://prod-remote.com/remoteEntry.js" }],
  });
  ```

### Debugging Tips
- **Verify Replacement**:
  ```bash
  grep "https://prod-remote.com" /path/to/dist/remoteEntry.js
  ```
- **Check Nginx Logs**:
  ```bash
  tail -f /var/log/nginx/error.log
  tail -f /var/log/nginx/access.log
  ```
- **Browser Network Tab**: Ensure the updated `remoteEntry.js` is served and the remote URL is correct.
- **Backup Manifest**:
  Modify the script to create a backup before replacement:
  ```bash
  cp "$MANIFEST_FILE" "$MANIFEST_FILE.bak"
  ```

### Best Practices
- **Validate URLs**: Add URL validation in the script to ensure `REMOTE_APP_URL` is a valid URL.
  ```bash
  if ! [[ "$REMOTE_URL" =~ ^https?:// ]]; then
    echo "Error: Invalid URL format for REMOTE_APP_URL"
    exit 1
  fi
  ```
- **Multiple Remotes**: Extend the script to handle multiple placeholders (e.g., `__REMOTE_APP1_URL__`, `__REMOTE_APP2_URL__`).
- **Logging**: Log changes to a file for auditing:
  ```bash
  echo "$(date): Updated $MANIFEST_FILE with $REMOTE_URL" >> /var/log/manifest-updates.log
  ```
- **Security**: Restrict script permissions (`chmod 700 update-manifest.sh`) and avoid exposing sensitive URLs in logs.

This script provides a simple way to update the manifest file before serving your application, avoiding the need for a full rebuild. If you need tweaks (e.g., handling multiple placeholders, integrating with a specific CI/CD tool, or supporting a separate manifest file), let me know!